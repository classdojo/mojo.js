// Generated by CoffeeScript 1.4.0
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(["require", "jquery", "events"], function(require, $, events) {
    var Template;
    return Template = (function(_super) {

      __extends(Template, _super);

      /*
      */


      function Template(options) {
        this.options = options;
        this._engine = options.engine;
        this._baseDir = options.directory;
        this.name = options.name;
      }

      /*
           renders the template with the given options
      */


      Template.prototype.render = function(options, callback) {
        var _this = this;
        this.load(function() {
          return _this._renderer.render(options, callback);
        });
        return this;
      };

      /*
           Loads the template source
      */


      Template.prototype.load = function(callback) {
        var _this = this;
        if (callback == null) {
          callback = (function() {});
        }
        if (this._loaded) {
          return callback(null, this.source);
        }
        this.once("loaded", callback);
        if (this._loading) {
          return this;
        }
        this._loading = true;
        require(["./engines/" + this._engine], function(engine) {
          return require(["text!" + _this._baseDir + "/" + _this._engine + "/" + _this.name + "." + engine.extension], function(source) {
            _this.source = source;
            _this._loading = false;
            _this._loaded = true;
            _this._renderer = engine.compile(source);
            return _this.emit("loaded", null, source);
          });
        });
        return this;
      };

      return Template;

    })(events.EventEmitter);
  });

}).call(this);
